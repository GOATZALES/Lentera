{% extends "base_planning.html" %}
{% load humanize %}
{% block title %}{{ page_title }} - Faskes {{ faskes_id }}{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <style>
        .event-card {
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
        }
        .event-card-header {
            background-color: #f8f9fa;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid #dee2e6;
        }
        .event-card-header h5 { margin-bottom: 0; font-size: 1.1rem; color: #495057;}
        .event-card-body { padding: 1.25rem; }
        .event-card-body p { margin-bottom: 0.5rem; color: #6c757d;}
        .event-card-body strong { color: #343a40; }
        .level-critical { color: #dc3545; font-weight: bold; }
        .level-high { color: #ffc107; font-weight: bold; }
        .level-medium { color: #fd7e14; font-weight: bold; }
        .level-low { color: #28a745; font-weight: bold; }
        .btn-view-risk-detail {
             background: linear-gradient(135deg, #6f42c1 0%, #4a148c 100%); /* Ungu gelap */
             color: white;
        }
    </style>
{% endblock %}

{% block content_planning %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
        <h1 class="h2">{{ page_title }}</h1>
        <!-- Mungkin ada tombol filter atau aksi global di sini -->
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% if active_disaster_events %}
        <p class="mb-3 text-muted">Berikut adalah kejadian darurat yang sedang aktif dan analisis risiko terkait:</p>
        <div class="row">
            {% for event in active_disaster_events %}
            <div class="col-md-6 col-lg-4">
                <div class="card event-card">
                    <div class="card-header event-card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-biohazard me-2 
                            {% if event.severity_level == 3 %}text-danger
                            {% elif event.severity_level == 2 %}text-warning
                            {% else %}text-info{% endif %}"></i>
                            {{ event.disaster_type }}
                        </h5>
                    </div>
                    <div class="card-body event-card-body">
                        <p><strong>Lokasi:</strong> {{ event.location_description }}</p>
                        <p><strong>Level Keparahan:</strong> 
                            <span class="
                                {% if event.severity_level == 3 %}level-critical
                                {% elif event.severity_level == 2 %}level-high 
                                {% elif event.severity_level == 1 %}level-medium
                                {% else %}level-low{% endif %}">
                                {{ event.get_severity_level_display }}
                            </span>
                        </p>
                        <p><strong>Aktif Sejak:</strong> {{ event.activation_time|naturalday:"d M Y" }} ({{ event.activation_time|timesince }} lalu)</p>
                        {% if event.ai_pre_positioning_recommendations_text %}
                            <p class="mt-2"><small class="text-success"><i class="fas fa-check-circle me-1"></i> Analisis AI Tersedia</small></p>
                        {% else %}
                            <p class="mt-2"><small class="text-warning"><i class="fas fa-hourglass-half me-1"></i> Analisis AI belum/tidak tersedia</small></p>
                        {% endif %}
                        <a href="{% url 'planning:disaster_event_detail' event.id %}" class="btn btn-sm btn-view-risk-detail mt-2 w-100">
                            <i class="fas fa-search-location me-1"></i> Lihat Detail & Rekomendasi
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center p-5 border rounded bg-light">
            <i class="fas fa-shield-alt fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Tidak Ada Kejadian Darurat Aktif</h4>
            <p>Saat ini tidak ada kejadian darurat yang memerlukan perhatian khusus dari sisi perencanaan.</p>
        </div>
    {% endif %}
</div>
{% endblock %}